@startuml
title Kafka Test - Microservice as Consumer

actor Developer
participant "GitLab CI Template" as CI
participant "Cucumber Runner" as C
participant "Kafka Stub POD" as K
participant "Microservice" as MS
participant "Downstream Stub (WireMock)" as WM

Developer -> CI: Trigger pipeline with RUN_TESTS
CI -> K: Create Kafka stub pod (from blank file)
CI -> MS: Deploy service with config (bootstrap.servers -> K)

C -> K: Seed dummy message in input topic
K -> MS: Deliver message (MS listener consumes)
MS -> WM: HTTP PATCH to downstream stub (e.g. UCRM)
WM --> MS: Return mock 200 OK
MS --> C: Final status = Success
C -> C: Validate outcome (HTTP response, or log of processing)

CI -> K: Scale down Kafka stub pod
@enduml
